<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5095ceac63f04c4071d6.css">.container{box-sizing:border-box;margin-left:auto;margin-right:auto;padding-right:8px;padding-left:8px}.container-fluid{padding-right:16px;padding-left:16px}@media only screen and (min-width:576px){.container{width:560px;max-width:100%}}@media only screen and (min-width:768px){.container{width:752px;max-width:100%}}@media only screen and (min-width:992px){.container{width:976px;max-width:100%}}@media only screen and (min-width:1200px){.container{width:1184px;max-width:100%}}.row{box-sizing:border-box;display:-webkit-flex;display:flex;-webkit-flex:0 1 auto;flex:0 1 auto;-webkit-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;flex-wrap:wrap;margin-right:-8px;margin-left:-8px}.row.reverse{-webkit-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-flex-direction:column-reverse;flex-direction:column-reverse}.col-lg,.col-lg-1,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-md,.col-md-1,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-10,.col-md-11,.col-md-12,.col-md-offset-0,.col-md-offset-1,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-sm,.col-sm-1,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-xl,.col-xl-1,.col-xl-2,.col-xl-3,.col-xl-4,.col-xl-5,.col-xl-6,.col-xl-7,.col-xl-8,.col-xl-9,.col-xl-10,.col-xl-11,.col-xl-12,.col-xl-offset-0,.col-xl-offset-1,.col-xl-offset-2,.col-xl-offset-3,.col-xl-offset-4,.col-xl-offset-5,.col-xl-offset-6,.col-xl-offset-7,.col-xl-offset-8,.col-xl-offset-9,.col-xl-offset-10,.col-xl-offset-11,.col-xl-offset-12,.col-xs,.col-xs-1,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12{box-sizing:border-box;-webkit-flex:0 0 auto;flex:0 0 auto;-webkit-flex-basis:100%;flex-basis:100%;padding-right:8px;padding-left:8px;max-width:100%}.col-xs{-webkit-flex-grow:1;flex-grow:1;-webkit-flex-basis:0;flex-basis:0;max-width:100%}.col-xs-1{-webkit-flex-basis:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-webkit-flex-basis:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-webkit-flex-basis:25%;flex-basis:25%;max-width:25%}.col-xs-4{-webkit-flex-basis:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-webkit-flex-basis:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-webkit-flex-basis:50%;flex-basis:50%;max-width:50%}.col-xs-7{-webkit-flex-basis:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-webkit-flex-basis:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-webkit-flex-basis:75%;flex-basis:75%;max-width:75%}.col-xs-10{-webkit-flex-basis:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-webkit-flex-basis:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-webkit-flex-basis:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-justify-content:flex-start;justify-content:flex-start;text-align:start}.center-xs{-webkit-justify-content:center;justify-content:center;text-align:center}.end-xs{-webkit-justify-content:flex-end;justify-content:flex-end;text-align:end}.top-xs{-webkit-align-items:flex-start;align-items:flex-start}.middle-xs{-webkit-align-items:center;align-items:center}.bottom-xs{-webkit-align-items:flex-end;align-items:flex-end}.around-xs{-webkit-justify-content:space-around;justify-content:space-around}.between-xs{-webkit-justify-content:space-between;justify-content:space-between}.first-xs{-webkit-order:-1;order:-1}.last-xs{-webkit-order:1;order:1}.initial-order-xs{-webkit-order:initial;order:0}@media only screen and (min-width:576px){.col-sm{-webkit-flex-grow:1;flex-grow:1;-webkit-flex-basis:0;flex-basis:0;max-width:100%}.col-sm-1{-webkit-flex-basis:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-webkit-flex-basis:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-webkit-flex-basis:25%;flex-basis:25%;max-width:25%}.col-sm-4{-webkit-flex-basis:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-webkit-flex-basis:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-webkit-flex-basis:50%;flex-basis:50%;max-width:50%}.col-sm-7{-webkit-flex-basis:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-webkit-flex-basis:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-webkit-flex-basis:75%;flex-basis:75%;max-width:75%}.col-sm-10{-webkit-flex-basis:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-webkit-flex-basis:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-webkit-flex-basis:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-justify-content:flex-start;justify-content:flex-start;text-align:start}.center-sm{-webkit-justify-content:center;justify-content:center;text-align:center}.end-sm{-webkit-justify-content:flex-end;justify-content:flex-end;text-align:end}.top-sm{-webkit-align-items:flex-start;align-items:flex-start}.middle-sm{-webkit-align-items:center;align-items:center}.bottom-sm{-webkit-align-items:flex-end;align-items:flex-end}.around-sm{-webkit-justify-content:space-around;justify-content:space-around}.between-sm{-webkit-justify-content:space-between;justify-content:space-between}.first-sm{-webkit-order:-1;order:-1}.last-sm{-webkit-order:1;order:1}.initial-order-sm{-webkit-order:initial;order:0}}@media only screen and (min-width:768px){.col-md,.col-md-1,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-10,.col-md-11,.col-md-12,.col-md-offset-0,.col-md-offset-1,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12{box-sizing:border-box;-webkit-flex:0 0 auto;flex:0 0 auto;padding-right:8px;padding-left:8px}.col-md{-webkit-flex-grow:1;flex-grow:1;-webkit-flex-basis:0;flex-basis:0;max-width:100%}.col-md-1{-webkit-flex-basis:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-webkit-flex-basis:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-webkit-flex-basis:25%;flex-basis:25%;max-width:25%}.col-md-4{-webkit-flex-basis:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-webkit-flex-basis:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-webkit-flex-basis:50%;flex-basis:50%;max-width:50%}.col-md-7{-webkit-flex-basis:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-webkit-flex-basis:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-webkit-flex-basis:75%;flex-basis:75%;max-width:75%}.col-md-10{-webkit-flex-basis:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-webkit-flex-basis:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-webkit-flex-basis:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-justify-content:flex-start;justify-content:flex-start;text-align:start}.center-md{-webkit-justify-content:center;justify-content:center;text-align:center}.end-md{-webkit-justify-content:flex-end;justify-content:flex-end;text-align:end}.top-md{-webkit-align-items:flex-start;align-items:flex-start}.middle-md{-webkit-align-items:center;align-items:center}.bottom-md{-webkit-align-items:flex-end;align-items:flex-end}.around-md{-webkit-justify-content:space-around;justify-content:space-around}.between-md{-webkit-justify-content:space-between;justify-content:space-between}.first-md{-webkit-order:-1;order:-1}.last-md{-webkit-order:1;order:1}.initial-order-md{-webkit-order:initial;order:0}}@media only screen and (min-width:992px){.col-lg,.col-lg-1,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12{box-sizing:border-box;-webkit-flex:0 0 auto;flex:0 0 auto;padding-right:8px;padding-left:8px}.col-lg{-webkit-flex-grow:1;flex-grow:1;-webkit-flex-basis:0;flex-basis:0;max-width:100%}.col-lg-1{-webkit-flex-basis:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-webkit-flex-basis:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-webkit-flex-basis:25%;flex-basis:25%;max-width:25%}.col-lg-4{-webkit-flex-basis:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-webkit-flex-basis:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-webkit-flex-basis:50%;flex-basis:50%;max-width:50%}.col-lg-7{-webkit-flex-basis:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-webkit-flex-basis:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-webkit-flex-basis:75%;flex-basis:75%;max-width:75%}.col-lg-10{-webkit-flex-basis:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-webkit-flex-basis:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-webkit-flex-basis:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-justify-content:flex-start;justify-content:flex-start;text-align:start}.center-lg{-webkit-justify-content:center;justify-content:center;text-align:center}.end-lg{-webkit-justify-content:flex-end;justify-content:flex-end;text-align:end}.top-lg{-webkit-align-items:flex-start;align-items:flex-start}.middle-lg{-webkit-align-items:center;align-items:center}.bottom-lg{-webkit-align-items:flex-end;align-items:flex-end}.around-lg{-webkit-justify-content:space-around;justify-content:space-around}.between-lg{-webkit-justify-content:space-between;justify-content:space-between}.first-lg{-webkit-order:-1;order:-1}.last-lg{-webkit-order:1;order:1}.initial-order-lg{-webkit-order:initial;order:0}}@media only screen and (min-width:1200px){.col-xl,.col-xl-1,.col-xl-2,.col-xl-3,.col-xl-4,.col-xl-5,.col-xl-6,.col-xl-7,.col-xl-8,.col-xl-9,.col-xl-10,.col-xl-11,.col-xl-12,.col-xl-offset-0,.col-xl-offset-1,.col-xl-offset-2,.col-xl-offset-3,.col-xl-offset-4,.col-xl-offset-5,.col-xl-offset-6,.col-xl-offset-7,.col-xl-offset-8,.col-xl-offset-9,.col-xl-offset-10,.col-xl-offset-11,.col-xl-offset-12{box-sizing:border-box;-webkit-flex:0 0 auto;flex:0 0 auto;padding-right:8px;padding-left:8px}.col-xl{-webkit-flex-grow:1;flex-grow:1;-webkit-flex-basis:0;flex-basis:0;max-width:100%}.col-xl-1{-webkit-flex-basis:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xl-2{-webkit-flex-basis:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xl-3{-webkit-flex-basis:25%;flex-basis:25%;max-width:25%}.col-xl-4{-webkit-flex-basis:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xl-5{-webkit-flex-basis:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xl-6{-webkit-flex-basis:50%;flex-basis:50%;max-width:50%}.col-xl-7{-webkit-flex-basis:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xl-8{-webkit-flex-basis:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xl-9{-webkit-flex-basis:75%;flex-basis:75%;max-width:75%}.col-xl-10{-webkit-flex-basis:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xl-11{-webkit-flex-basis:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xl-12{-webkit-flex-basis:100%;flex-basis:100%;max-width:100%}.col-xl-offset-0{margin-left:0}.col-xl-offset-1{margin-left:8.33333333%}.col-xl-offset-2{margin-left:16.66666667%}.col-xl-offset-3{margin-left:25%}.col-xl-offset-4{margin-left:33.33333333%}.col-xl-offset-5{margin-left:41.66666667%}.col-xl-offset-6{margin-left:50%}.col-xl-offset-7{margin-left:58.33333333%}.col-xl-offset-8{margin-left:66.66666667%}.col-xl-offset-9{margin-left:75%}.col-xl-offset-10{margin-left:83.33333333%}.col-xl-offset-11{margin-left:91.66666667%}.start-xl{-webkit-justify-content:flex-start;justify-content:flex-start;text-align:start}.center-xl{-webkit-justify-content:center;justify-content:center;text-align:center}.end-xl{-webkit-justify-content:flex-end;justify-content:flex-end;text-align:end}.top-xl{-webkit-align-items:flex-start;align-items:flex-start}.middle-xl{-webkit-align-items:center;align-items:center}.bottom-xl{-webkit-align-items:flex-end;align-items:flex-end}.around-xl{-webkit-justify-content:space-around;justify-content:space-around}.between-xl{-webkit-justify-content:space-between;justify-content:space-between}.first-xl{-webkit-order:-1;order:-1}.last-xl{-webkit-order:1;order:1}.initial-order-xl{-webkit-order:initial;order:0}}@media only screen and (max-width:575px){.hidden-xs{display:none}}@media only screen and (min-width:576px) and (max-width:767px){.hidden-sm{display:none}}@media only screen and (min-width:768px) and (max-width:991px){.hidden-md{display:none}}@media only screen and (min-width:992px) and (max-width:1199px){.hidden-lg{display:none}}@media only screen and (min-width:1200px){.hidden-xl{display:none}}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#333;overflow:hidden;line-height:1.6;word-wrap:break-word}.markdown-body a{background:transparent}.markdown-body a:active,.markdown-body a:hover{outline:0}.markdown-body strong{font-weight:700}.markdown-body h1{font-size:2em;margin:.67em 0}.markdown-body hr{box-sizing:content-box}.markdown-body pre{overflow:auto;white-space:pre;padding:1.25rem;margin:40px 0;border:1px solid #d8d8d8;-o-border-image:initial;border-image:initial}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body input{color:inherit;font:inherit;margin:0}.markdown-body html input[disabled]{cursor:default}.markdown-body input{line-height:normal}.markdown-body input[type=checkbox]{box-sizing:border-box;padding:0}.markdown-body table{border-collapse:collapse;border-spacing:0}.markdown-body td,.markdown-body th{padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font:13px/1.4 Helvetica,arial,freesans,clean,sans-serif,Segoe UI Emoji,Segoe UI Symbol}.markdown-body a{color:#4183c4;text-decoration:none}.markdown-body a:active,.markdown-body a:focus,.markdown-body a:hover{text-decoration:underline}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #ddd}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:15px;margin-bottom:15px;line-height:1.1}.markdown-body h1{font-size:30px}.markdown-body h2{font-size:21px}.markdown-body h3{font-size:16px}.markdown-body h4{font-size:14px}.markdown-body h5{font-size:12px}.markdown-body h6{font-size:11px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body kbd{background-color:#e7e7e7;background-image:linear-gradient(#fefefe,#e7e7e7);background-repeat:repeat-x;border-radius:2px;border:1px solid #cfcfcf;color:#000;padding:3px 5px;line-height:10px;font:11px Consolas,Liberation Mono,Menlo,Courier,monospace;display:inline-block}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body .anchor{position:absolute;top:0;bottom:0;left:0;display:block;padding-right:6px;padding-left:30px;margin-left:-30px}.markdown-body .anchor:focus{outline:none}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:1em;margin-bottom:16px;font-weight:700;line-height:1.4}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{display:none;color:#000;vertical-align:middle}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{height:1em;padding-left:8px;margin-left:-30px;line-height:1;text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{display:inline-block}.markdown-body h1{font-size:2.25em;line-height:1.2}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.75em;line-height:1.225}.markdown-body h3{font-size:1.5em;line-height:1.43}.markdown-body h4{font-size:1.25em}.markdown-body h5{font-size:1em}.markdown-body h6{font-size:1em;color:#777}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:4px;padding:0;margin:16px 0;background-color:#e7e7e7;border:0}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body blockquote{padding:0 15px;color:#777;border-left:4px solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:border-box}.markdown-body .octicon{font:normal normal 16px octicons-anchor;line-height:1;display:inline-block;text-decoration:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .octicon-link:before{content:"\F05C"}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{float:left;margin:.3em 0 .25em -1.6em;vertical-align:middle}code[class*=language-],pre[class*=language-]{color:#000;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:.95em;line-height:1.4em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.namespace{opacity:.7}.token.string{color:#028265}.token.attr-value,.token.operator,.token.punctuation{color:#000}.token.boolean,.token.constant,.token.inserted,.token.symbol,.token.url,.token.variable{color:#36acaa}.language-autohotkey .token.selector,.language-json .token.boolean,.token.atrule,code[class*=language-css]{font-weight:600}.language-json .token.boolean{color:#0076ff}.token.keyword{color:#ff0078;font-weight:bolder}.token.class-name,.token.function,.token.number,.token.tag{color:#0076ff}.language-autohotkey .token.tag,.token.deleted{color:#9a050f}.language-autohotkey .token.keyword,.token.selector{color:#00009f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.language-json .token.property,.language-markdown .token.title{color:#000;font-weight:bolder}.language-markdown .token.code{color:#0076ff;font-weight:400}.language-markdown .token.hr,.language-markdown .token.list{color:#999}.language-markdown .token.url{color:#ff0078;font-weight:bolder}.token.selector{color:#2b91af}.token.entity,.token.property{color:red}.token.attr-name,.token.regex{color:#d9931e}.token.directive.tag .tag{background:#ff0;color:#393a34}pre.dark[class*=language-]{color:#fafbfc}.language-json .dark .token.boolean{color:#0076ff}.dark .token.string{color:#50e3c2}.dark .token.class-name,.dark .token.function,.dark .token.number,.dark .token.tag{color:#2ba8ff}.dark .token.attr-value,.dark .token.operator,.dark .token.punctuation{color:#efefef}.dark .token.attr-name,.dark .token.regex{color:#fac863}.language-json .dark .token.property,.language-markdown .dark .token.title{color:#fff}.language-markdown .dark .token.code{color:#50e3c2}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:inherit}pre[class*=language-]{border-radius:unset}body{margin:0;font-family:Open Sans,sans-serif;background:#fff}::selection{background:#0076ff;color:#fff}.gatsby-resp-image-image{border:1px solid #000}*{box-sizing:border-box}</style><meta name="generator" content="Gatsby 2.1.4"/><title data-react-helmet="true">nowke | Navaneesh Kumar</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Noto+Serif:400" rel="stylesheet"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet"/><script data-react-helmet="true" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async=""></script><link as="script" rel="preload" href="/webpack-runtime-545d7a8d911f5a40b60c.js"/><link as="script" rel="preload" href="/app-993239f85bfee703f187.js"/><link as="script" rel="preload" href="/styles-b03ebb414d027cb36da8.js"/><link as="script" rel="preload" href="/1-4ee94accbe56df593520.js"/><link as="script" rel="preload" href="/component---src-templates-notebook-js-c805186f3ab5e970b418.js"/><link as="fetch" rel="preload" href="/static/d/180/path---realtime-dashboard-2-f-3-142-mhFMNm4kU20BzzzHRz0QfPIkM.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><nav class="sc-bdVaJa foLxXb"><div class="sc-bwzfXH ihdYmK"><a style="text-decoration:none;color:unset" href="/"><h1 class="sc-htpNat fZhxaZ">nowke</h1></a><div class="sc-bxivhb hdcUOX"><ul class="sc-ifAKCX kqKUjj"><li class="sc-EHOje laLWot"><a href="https://github.com/nowke" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+R2l0SHViIGljb248L3RpdGxlPjxwYXRoIGQ9Ik0xMiAuMjk3Yy02LjYzIDAtMTIgNS4zNzMtMTIgMTIgMCA1LjMwMyAzLjQzOCA5LjggOC4yMDUgMTEuMzg1LjYuMTEzLjgyLS4yNTguODItLjU3NyAwLS4yODUtLjAxLTEuMDQtLjAxNS0yLjA0LTMuMzM4LjcyNC00LjA0Mi0xLjYxLTQuMDQyLTEuNjFDNC40MjIgMTguMDcgMy42MzMgMTcuNyAzLjYzMyAxNy43Yy0xLjA4Ny0uNzQ0LjA4NC0uNzI5LjA4NC0uNzI5IDEuMjA1LjA4NCAxLjgzOCAxLjIzNiAxLjgzOCAxLjIzNiAxLjA3IDEuODM1IDIuODA5IDEuMzA1IDMuNDk1Ljk5OC4xMDgtLjc3Ni40MTctMS4zMDUuNzYtMS42MDUtMi42NjUtLjMtNS40NjYtMS4zMzItNS40NjYtNS45MyAwLTEuMzEuNDY1LTIuMzggMS4yMzUtMy4yMi0uMTM1LS4zMDMtLjU0LTEuNTIzLjEwNS0zLjE3NiAwIDAgMS4wMDUtLjMyMiAzLjMgMS4yMy45Ni0uMjY3IDEuOTgtLjM5OSAzLS40MDUgMS4wMi4wMDYgMi4wNC4xMzggMyAuNDA1IDIuMjgtMS41NTIgMy4yODUtMS4yMyAzLjI4NS0xLjIzLjY0NSAxLjY1My4yNCAyLjg3My4xMiAzLjE3Ni43NjUuODQgMS4yMyAxLjkxIDEuMjMgMy4yMiAwIDQuNjEtMi44MDUgNS42MjUtNS40NzUgNS45Mi40Mi4zNi44MSAxLjA5Ni44MSAyLjIyIDAgMS42MDYtLjAxNSAyLjg5Ni0uMDE1IDMuMjg2IDAgLjMxNS4yMS42OS44MjUuNTdDMjAuNTY1IDIyLjA5MiAyNCAxNy41OTIgMjQgMTIuMjk3YzAtNi42MjctNS4zNzMtMTItMTItMTIiLz48L3N2Zz4=" class="sc-bZQynM jQqbTZ"/></a></li><li class="sc-EHOje laLWot"><a href="https://www.linkedin.com/in/nowke/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+TGlua2VkSW4gaWNvbjwvdGl0bGU+PHBhdGggZD0iTTIwLjQ0NyAyMC40NTJoLTMuNTU0di01LjU2OWMwLTEuMzI4LS4wMjctMy4wMzctMS44NTItMy4wMzctMS44NTMgMC0yLjEzNiAxLjQ0NS0yLjEzNiAyLjkzOXY1LjY2N0g5LjM1MVY5aDMuNDE0djEuNTYxaC4wNDZjLjQ3Ny0uOSAxLjYzNy0xLjg1IDMuMzctMS44NSAzLjYwMSAwIDQuMjY3IDIuMzcgNC4yNjcgNS40NTV2Ni4yODZ6TTUuMzM3IDcuNDMzYy0xLjE0NCAwLTIuMDYzLS45MjYtMi4wNjMtMi4wNjUgMC0xLjEzOC45Mi0yLjA2MyAyLjA2My0yLjA2MyAxLjE0IDAgMi4wNjQuOTI1IDIuMDY0IDIuMDYzIDAgMS4xMzktLjkyNSAyLjA2NS0yLjA2NCAyLjA2NXptMS43ODIgMTMuMDE5SDMuNTU1VjloMy41NjR2MTEuNDUyek0yMi4yMjUgMEgxLjc3MUMuNzkyIDAgMCAuNzc0IDAgMS43Mjl2MjAuNTQyQzAgMjMuMjI3Ljc5MiAyNCAxLjc3MSAyNGgyMC40NTFDMjMuMiAyNCAyNCAyMy4yMjcgMjQgMjIuMjcxVjEuNzI5QzI0IC43NzQgMjMuMiAwIDIyLjIyMiAwaC4wMDN6Ii8+PC9zdmc+" class="sc-bZQynM jQqbTZ"/></a></li><li class="sc-EHOje laLWot"><a href="https://twitter.com/inowke" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+VHdpdHRlciBpY29uPC90aXRsZT48cGF0aCBkPSJNMjMuOTU0IDQuNTY5Yy0uODg1LjM4OS0xLjgzLjY1NC0yLjgyNS43NzUgMS4wMTQtLjYxMSAxLjc5NC0xLjU3NCAyLjE2My0yLjcyMy0uOTUxLjU1NS0yLjAwNS45NTktMy4xMjcgMS4xODQtLjg5Ni0uOTU5LTIuMTczLTEuNTU5LTMuNTkxLTEuNTU5LTIuNzE3IDAtNC45MiAyLjIwMy00LjkyIDQuOTE3IDAgLjM5LjA0NS43NjUuMTI3IDEuMTI0QzcuNjkxIDguMDk0IDQuMDY2IDYuMTMgMS42NCAzLjE2MWMtLjQyNy43MjItLjY2NiAxLjU2MS0uNjY2IDIuNDc1IDAgMS43MS44NyAzLjIxMyAyLjE4OCA0LjA5Ni0uODA3LS4wMjYtMS41NjYtLjI0OC0yLjIyOC0uNjE2di4wNjFjMCAyLjM4NSAxLjY5MyA0LjM3NCAzLjk0NiA0LjgyNy0uNDEzLjExMS0uODQ5LjE3MS0xLjI5Ni4xNzEtLjMxNCAwLS42MTUtLjAzLS45MTYtLjA4Ni42MzEgMS45NTMgMi40NDUgMy4zNzcgNC42MDQgMy40MTctMS42OCAxLjMxOS0zLjgwOSAyLjEwNS02LjEwMiAyLjEwNS0uMzkgMC0uNzc5LS4wMjMtMS4xNy0uMDY3IDIuMTg5IDEuMzk0IDQuNzY4IDIuMjA5IDcuNTU3IDIuMjA5IDkuMDU0IDAgMTMuOTk5LTcuNDk2IDEzLjk5OS0xMy45ODYgMC0uMjA5IDAtLjQyLS4wMTUtLjYzLjk2MS0uNjg5IDEuOC0xLjU2IDIuNDYtMi41NDhsLS4wNDctLjAyeiIvPjwvc3ZnPg==" class="sc-bZQynM jQqbTZ"/></a></li></ul></div></div></nav><div class="sc-gzVnrw bFpLFo"><div class="sc-htoDjs gcfugt"><br/><div class="markdown-body"><h1>Real-time Dashboard</h1><div><p>In this post, we will be creating a simple scalable dashboard that updates in real-time using <a href="ll">React</a>, <a href="ll">GraphQL Subscriptions</a> and <a href="ll">Redis PubSub</a>. Real-time dashboards can be used to monitor your <strong>infrastructure</strong> (servers, network, services), <strong>application traffic</strong> (transaction volume, number of users), <strong>alerts</strong> (application health, critical issues, downtimes) etc. Almost always, dashboards are backed up with one or more datasources.</p>
<p>There are many open-source applications that can be used to create dashboards. For example, <strong><a href="ll">Kibana</a></strong> can be used to visualize application logs integrated with <a href="ll">ELK Stack</a>. <strong><a href="ll">Grafana</a></strong> can be used to create a variety of visualizations on top of time series databases such as <a href="ll">Prometheus</a>, <a href="ll">Graphite</a> and <a href="ll">OpenTSDB</a>. But, as of today, they support <a href="https://en.wikipedia.org/wiki/Pull_technology">pull-based model</a>. That is, when a user opens the browser, application makes the queries and result is rendered. It is the most widely used model as opposed to a <a href="https://en.wikipedia.org/wiki/Push_technology">Push model</a>. </p>
<h2>When push-model can be used?</h2>
<p>Assume you have a dashboard containing <strong><em>20 panels</em></strong>, querying data from multiple datasources at the backend in real-time. User has set a refresh rate of <strong><em>5 seconds</em></strong>. If, on an average <strong><em>100 users</em></strong> open the dashboard at any time - that is <strong><em>20 x 100 = 2000 requests</em></strong> every 5 seconds! This is manageable if you have good infrastructure for your underlying time-series database. Multiple Heavy queries can pile-up the memory. This problem can be solved either by introducing some intelligent caching, or a simple push-model using <a href="ll">WebSockets</a>. It is useful (and simple), for the situation where multiple users are querying for the same data, at same or slightly-different time. </p>
<ul>
<li>Connection is established between server and client using WebSocket.</li>
<li>Server sends the required data to Client at regular intervals</li>
<li>If the connection breaks, client can retry indefinitely.</li>
</ul>
<h3>What are we building?</h3>
<p>Here's the preview of a simple real-time dashboard we will be building. It contains 4 panels - CPU Utilization, Traffic information, Data-center distribution and alerts.</p>
<img src="/demo-c4fc92aed4a93e02edf4e7e71dd700e5.gif" alt="Real-time dashboard preview" style="border: 1px solid #000;">
<h2>GraphQL Subscriptions</h2>
<p><a href="ll">GraphQL</a> is a query language for APIs and a runtime for fulfilling those queries with your existing data. Check out <a href="https://graphql.org/">graphql.org</a> for more info if you are not familiar with GraphQL.</p>
<p>Along with <a href="ll">queries</a> and <a href="ll">mutations</a>, GraphQL introduced one more specification - <a href="ll">Subscriptions</a>. </p>
<blockquote>
<p> just as the list of mutations that the server supports describes all of the actions that a client can take, the list of subscriptions that the server supports describes all of the events that it can subscribe to. Just as a client can tell the server what data to refetch after it performs a mutation with a GraphQL selection, the client can tell the server what data it wants to be pushed with the subscription with a GraphQL selection. - <a href="https://graphql.org/blog/subscriptions-in-graphql-and-relay/">GraphQL blog</a></p>
</blockquote>
<p>For example, client can subscribe for CPU data using the following subscription syntax</p>
<div class="gatsby-highlight" data-language="graphql"><pre style="counter-reset: linenumber NaN" class="language-graphql line-numbers"><code class="language-graphql">subscription CPU <span class="token punctuation">{</span>
  cpu <span class="token punctuation">{</span>
    percentage
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Server can publish the data at regular intervals,</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">pubsub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token constant">CPU</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> cpu<span class="token punctuation">:</span> <span class="token punctuation">{</span> percentage<span class="token punctuation">:</span> <span class="token number">65</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Redis PubSub</h2>
<p>Since version 2.0, Redis supports <a href="http://en.wikipedia.org/wiki/Publish/subscribe">Publish-Subscribe pattern</a> using commands <a href="https://redis.io/commands/publish">PUBLISH</a>, <a href="https://redis.io/commands/subscribe">SUBSCRIBE</a> and <a href="https://redis.io/commands/unsubscribe">UNSUBSCRIBE</a>. Read more about it from <a href="https://redis.io/topics/pubsub">Redis Documentation</a>.</p>
<p>Message can be published via <strong>channels</strong>. If we want to send message <code class="language-text">&quot;hello listeners&quot;</code> via channel <code class="language-text">myradio</code>, simply use the <code class="language-text">PUBLISH</code> command</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">PUBLISH myradio <span class="token string">"hello listeners"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>But, a channel is useless if nobody is listening on the other side! Open another tab with <code class="language-text">redis-cli</code> and subscribe to the channel <code class="language-text">myradio</code>.</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">SUBSCRIBE myradio</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Now, send the publish command again and watch for the same in the other terminal</p>
<p><a
    class="gatsby-resp-image-link"
    href="/static/4954734d475d7e5ea62d214bf7942fbe/2a77b/redis-pubsub-terminal.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 29.639639639639636%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7klEQVQY03WQy4qEQAxFyxe+EFtae6EbQUUFdeFPuGhQG18LN/7/T9yehNFhhunFIVW3cpNUxL7vOI4DFNd1ZeZ5xrIsDJ3HcWSmacK2bZi+tGEY8Hq90Pc9ns8nuq5jRJ7nIB6PB+73O8fb7QbbtuG6LjzPg6IoEELwW1VVKMuS9SAI4Ps+DMOAqqqcI4qiQJqmiOOYDZqmQdf1C0q2LAuyLCOKItR1jSRJ2EzaCfm4MV0kSfoRqMsHqGDbtsiy7GpCOvmvyOK3cIr/QW9hGKJpGp6QVmKa5q+inEdTfSrytyDtzXGcC9r1+asz5w1JPJcuRbYSbwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="Redis PubSub in terminal"
        title=""
        src="/static/4954734d475d7e5ea62d214bf7942fbe/40fad/redis-pubsub-terminal.png"
        srcset="/static/4954734d475d7e5ea62d214bf7942fbe/707e9/redis-pubsub-terminal.png 148w,
/static/4954734d475d7e5ea62d214bf7942fbe/649e0/redis-pubsub-terminal.png 295w,
/static/4954734d475d7e5ea62d214bf7942fbe/40fad/redis-pubsub-terminal.png 590w,
/static/4954734d475d7e5ea62d214bf7942fbe/b3fef/redis-pubsub-terminal.png 885w,
/static/4954734d475d7e5ea62d214bf7942fbe/2a77b/redis-pubsub-terminal.png 1110w"
        sizes="(max-width: 590px) 100vw, 590px"
      />
  </span>
  </a></p>
<h3>Combining GraphQL subscription &#x26; Redis PubSub</h3>
<p>We can implement GraphQL subscription specification using <a href="https://www.apollographql.com/">Apollo</a>'s package - <a href="https://github.com/apollographql/graphql-subscriptions">graphql-subscriptions</a>. </p>
<p>Using Redis as mediator for publishing events from client to server enables us horizontally scale. We can plug in <a href="https://github.com/davidyaha/graphql-redis-subscriptions">graphql-redis-subscriptions</a> as PubSubEngine interface to <code class="language-text">graphql-subscriptions</code>.</p>
<h2>Sample Implementation</h2>
<p>For full implementation - see <a href="https://github.com/nowke/realtime-dashboard-demo/">github.com/nowke/realtime-dashboard-demo/</a>. We will look at the important parts here.</p>
<p>We're going to build 3 components</p>
<ul>
<li>Server</li>
<li>Client - user's browser, connects to server</li>
<li>Worker - mocks real events by publishing events to server</li>
</ul>
<h3>Server</h3>
<p>Install the required pacakges</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">yarn add graphql apollo-server graphql-redis-subscriptions graphql-subscriptions ioredis moment</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>If you have <code class="language-text">redis-server</code> running in local at <code class="language-text">PORT 6379</code>, setup the PubSub using <code class="language-text">graphql-redis-subscriptions</code>. We will use it to publish messages</p>
<p><strong><a href="https://github.com/nowke/realtime-dashboard-demo/blob/master/server/pubsub.js"><code class="language-text">server/pubsub.js</code></a></strong></p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> RedisPubSub <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"graphql-redis-subscriptions"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pubsub <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisPubSub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> pubsub<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Define the GraphQL schema. We use,</p>
<ul>
<li><strong>Query</strong> - for getting initial result from Redis</li>
<li><strong>Mutation</strong> - to publish new messages</li>
<li><strong>Subscription</strong> - websocket connection between client and server for real-time updating the graphs</li>
</ul>
<div class="gatsby-highlight" data-language="graphql"><pre style="counter-reset: linenumber NaN" class="language-graphql line-numbers"><code class="language-graphql">const <span class="token punctuation">{</span> gql <span class="token punctuation">}</span> <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"apollo-server"</span><span class="token punctuation">)</span>;

const schema <span class="token operator">=</span> gql`
  type Dps <span class="token punctuation">{</span>
    <span class="token attr-name">timestamp</span><span class="token punctuation">:</span> Int<span class="token operator">!</span>
    <span class="token attr-name">value</span><span class="token punctuation">:</span> Float<span class="token operator">!</span>
  <span class="token punctuation">}</span>

  type Traffic <span class="token punctuation">{</span>
    <span class="token attr-name">total</span><span class="token punctuation">:</span> Int<span class="token operator">!</span>
    <span class="token attr-name">dps</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Dps<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  type CPU <span class="token punctuation">{</span>
    <span class="token attr-name">percentage</span><span class="token punctuation">:</span> Float<span class="token operator">!</span>
  <span class="token punctuation">}</span>

  type Distribution <span class="token punctuation">{</span>
    <span class="token attr-name">region</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
    <span class="token attr-name">percentage</span><span class="token punctuation">:</span> Float<span class="token operator">!</span>
  <span class="token punctuation">}</span>

  type Message <span class="token punctuation">{</span>
    <span class="token attr-name">title</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
    <span class="token attr-name">description</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
    <span class="token attr-name">color</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token punctuation">}</span>

  type Query <span class="token punctuation">{</span>
    <span class="token attr-name">cpu</span><span class="token punctuation">:</span> CPU
    <span class="token attr-name">traffic</span><span class="token punctuation">:</span> Traffic
    <span class="token attr-name">distribution</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Distribution<span class="token punctuation">]</span>
    <span class="token attr-name">messages</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Message<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  type Mutation <span class="token punctuation">{</span>
    <span class="token attr-name">cpu</span><span class="token punctuation">:</span> CPU
    <span class="token attr-name">traffic</span><span class="token punctuation">:</span> Traffic
    <span class="token attr-name">distribution</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Distribution<span class="token punctuation">]</span>
    <span class="token attr-name">messages</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Message<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  type Subscription <span class="token punctuation">{</span>
    <span class="token attr-name">cpu</span><span class="token punctuation">:</span> CPU
    <span class="token attr-name">traffic</span><span class="token punctuation">:</span> Traffic
    <span class="token attr-name">distribution</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Distribution<span class="token punctuation">]</span>
    <span class="token attr-name">messages</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Message<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
`;

module.exports <span class="token operator">=</span> schema;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>I have provided helper functions to generate dummy data for each 4 panels. Refer <a href="https://github.com/nowke/realtime-dashboard-demo/blob/master/server/utils/generator.js"><code class="language-text">server/utils/generator.js</code></a>. Using these functions, let's write a function <code class="language-text">publishRandomData</code>.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> pubsub <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./pubsub"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">set</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./utils/redis"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">COMPONENTS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">CPU</span><span class="token punctuation">:</span> <span class="token string">"cpu"</span><span class="token punctuation">,</span>
  <span class="token constant">TRAFFIC</span><span class="token punctuation">:</span> <span class="token string">"traffic"</span><span class="token punctuation">,</span>
  <span class="token constant">DISTRIBUTION</span><span class="token punctuation">:</span> <span class="token string">"distribution"</span><span class="token punctuation">,</span>
  <span class="token constant">MESSAGES</span><span class="token punctuation">:</span> <span class="token string">"messages"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> publishRandomData <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>generator<span class="token punctuation">,</span> component<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pubsub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>component<span class="token punctuation">]</span><span class="token punctuation">:</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token keyword">set</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>We can call this function for CPU usage as below</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getCPU</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">publishRandomData</span><span class="token punctuation">(</span>getCPU<span class="token punctuation">,</span> <span class="token string">"CPU"</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Define the resolver functions for the schema we wrote earlier (sample for CPU)</p>
<p><strong><a href="https://github.com/nowke/realtime-dashboard-demo/blob/master/server/resolvers.js"><code class="language-text">server/resolvers.js</code></a></strong></p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./utils/redis"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  Query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    cpu<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token constant">COMPONENTS</span><span class="token punctuation">.</span><span class="token constant">CPU</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  Mutation<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    cpu<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">publishRandomData</span><span class="token punctuation">(</span>cpuData<span class="token punctuation">,</span> <span class="token constant">COMPONENTS</span><span class="token punctuation">.</span><span class="token constant">CPU</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  Subscription<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    cpu<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      subscribe<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> pubsub<span class="token punctuation">.</span><span class="token function">asyncIterator</span><span class="token punctuation">(</span><span class="token constant">COMPONENTS</span><span class="token punctuation">.</span><span class="token constant">CPU</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Start the server</p>
<p><strong><a href="https://github.com/nowke/realtime-dashboard-demo/blob/master/server/index.js"><code class="language-text">server/index.js</code></a></strong></p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> ApolloServer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"apollo-server"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> typeDefs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./schema"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./resolvers"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Server</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> typeDefs<span class="token punctuation">,</span> resolvers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`🚀  Server ready at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">$ yarn start
yarn run v1.13.0
$ nodemon index.js
...
🚀  Server ready at http://localhost:4000/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Go to <a href="http://localhost:4000/">localhost:4000</a> to open GraphQL playground.</p>
<p>Subscribe to CPU percentage in <strong>Tab 1</strong> and hit the play button</p>
<div class="gatsby-highlight" data-language="graphql"><pre style="counter-reset: linenumber NaN" class="language-graphql line-numbers"><code class="language-graphql">subscription <span class="token punctuation">{</span>
  cpu <span class="token punctuation">{</span>
    percentage
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Run the mutation for CPU in <strong>Tab 2</strong>, to publish random percentage value. You should receive the value as an event in <strong>Tab 1</strong>. Try the mutation multiple times to receive different values.</p>
<div class="gatsby-highlight" data-language="graphql"><pre style="counter-reset: linenumber NaN" class="language-graphql line-numbers"><code class="language-graphql"><span class="token keyword">mutation</span> <span class="token punctuation">{</span>
  cpu <span class="token punctuation">{</span>
    percentage
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Run the query for CPU in <strong>Tab 3</strong>. You should see the last published value - this is because we have cached the recent value in Redis</p>
<div class="gatsby-highlight" data-language="graphql"><pre style="counter-reset: linenumber NaN" class="language-graphql line-numbers"><code class="language-graphql"><span class="token keyword">query</span> <span class="token punctuation">{</span>
  cpu <span class="token punctuation">{</span>
    percentage
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"cpu"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"percentage"</span><span class="token operator">:</span> <span class="token number">25</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Client</h3>
<p>Create a new React application using <code class="language-text">create-react-app</code> for client</p>
<div class="gatsby-highlight" data-language="sh"><pre style="counter-reset: linenumber NaN" class="language-sh line-numbers"><code class="language-sh">yarn create react-app client</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Install the required dependencies.</p>
<div class="gatsby-highlight" data-language="sh"><pre style="counter-reset: linenumber NaN" class="language-sh line-numbers"><code class="language-sh">yarn add apollo-boost apollo-client apollo-link-ws graphql react-apollo subscriptions-transport-ws</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Setup Apollo HTTP client and websocket client, since we need both type of connection to the server. HTTP server will be running at <code class="language-text">http://localhost:4000</code> and websocket subscription server at <code class="language-text">ws://localhost:4000/graphql</code>.</p>
<p><strong><a href="https://github.com/nowke/realtime-dashboard-demo/blob/master/client/src/App.js"><code class="language-text">client/src/App.js</code></a></strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"apollo-client"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> InMemoryCache <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"apollo-cache-inmemory"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-apollo"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> split <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"apollo-link"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpLink <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"apollo-link-http"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> WebSocketLink <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"apollo-link-ws"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getMainDefinition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"apollo-utilities"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">"./Pages/Home"</span><span class="token punctuation">;</span>

<span class="token comment">// Create an http link:</span>
<span class="token keyword">const</span> httpLink <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpLink</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  uri<span class="token punctuation">:</span> <span class="token string">"http://localhost:4000"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a WebSocket link:</span>
<span class="token keyword">const</span> wsLink <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketLink</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  uri<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`ws://localhost:4000/graphql`</span></span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    reconnect<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// using the ability to split links, you can send data to each link</span>
<span class="token comment">// depending on what kind of operation is being sent</span>
<span class="token keyword">const</span> link <span class="token operator">=</span> <span class="token function">split</span><span class="token punctuation">(</span>
  <span class="token comment">// split based on operation type</span>
  <span class="token punctuation">(</span><span class="token punctuation">{</span> query <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> kind<span class="token punctuation">,</span> operation <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getMainDefinition</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> kind <span class="token operator">===</span> <span class="token string">"OperationDefinition"</span> <span class="token operator">&amp;&amp;</span> operation <span class="token operator">===</span> <span class="token string">"subscription"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  wsLink<span class="token punctuation">,</span>
  httpLink
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  link<span class="token punctuation">,</span>
  cache<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ApolloProvider</span> <span class="token attr-name">client</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Home</span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ApolloProvider</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>We have wrapped our <code class="language-text">Home</code> component with <code class="language-text">ApolloProvider</code>, which enables us to run queries and subscriptions.</p>
<p>Let us design CPU usage component - <a href="https://github.com/nowke/realtime-dashboard-demo/blob/master/client/src/components/CpuUsage.js">CpuUsage.js</a>.</p>
<p>Define the query and subscription</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> gql <span class="token keyword">from</span> <span class="token string">"graphql-tag"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">QUERY</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token string">`
  query CPU {
    cpu {
      percentage
    }
  }
`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">SUBSCRIPTION</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token string">`
  subscription CPU {
    cpu {
      percentage
    }
  }
`</span></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Our requirement is as follows.</p>
<ul>
<li>On initial load, data should be rendered via <code class="language-text">query</code></li>
<li>Post load, component should render the value from subscription</li>
</ul>
<p>This can be achieved using <code class="language-text">subscribeToMore</code> prop given by <code class="language-text">Query</code> component in <code class="language-text">react-apollo</code> - <a href="https://www.apollographql.com/docs/react/advanced/subscriptions.html#subscribe-to-more">https://www.apollographql.com/docs/react/advanced/subscriptions.html#subscribe-to-more</a></p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-apollo"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">CpuUsageContainer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Query</span> <span class="token attr-name">query</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token constant">QUERY</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> subscribeToMore<span class="token punctuation">,</span> <span class="token operator">...</span>result <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CpuUsage</span>
        <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">result</span><span class="token punctuation">}</span></span>
        <span class="token attr-name">subscribeToNewData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
          <span class="token function">subscribeToMore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            document<span class="token punctuation">:</span> <span class="token constant">SUBSCRIPTION</span><span class="token punctuation">,</span>
            updateQuery<span class="token punctuation">:</span> <span class="token punctuation">(</span>prev<span class="token punctuation">,</span> <span class="token punctuation">{</span> subscriptionData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>subscriptionData<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token keyword">return</span> prev<span class="token punctuation">;</span>
              <span class="token keyword">return</span> subscriptionData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span></span>
      <span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Query</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Display CPU percentage inside <code class="language-text">CpuUsage</code> component.</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">CpuUsage</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">subscribeToNewData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token punctuation">,</span> error<span class="token punctuation">,</span> loading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loading<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"> Loading ... </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Error!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"> CPU Usage: </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">.</span>percentage<span class="token punctuation">}</span><span class="token plain-text">% </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Refer the file <a href="https://github.com/nowke/realtime-dashboard-demo/blob/master/client/src/components/CpuUsage.js">CpuUsage.js</a> for complete class definition with Pie chart</p>
<p><a
    class="gatsby-resp-image-link"
    href="/static/25fc9396db647a3270c468e3a1ff26c8/37844/cpu.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block;  max-width: 347px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 103.45821325648417%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACMUlEQVQ4y7VUTWgTQRhd8C6Cip4F0SJYUFDE+BOpeCvYGvAmQvWkF03VUqjWWqHWWsWCBymiEfJjJI272FWDHtSDSqVUSghRVAykCoY2TXY3mZ19zk6SZTf9cS31Wx47++bN4+3MxwiqqmG2UFwWFBiE6Zk8KDVAiA6izw+doUzKKFVBCOGcpWFrKaUoFBUI+dkCllLUoHM4VdMgzOQrhoZhzIvaQulLArfHhjE2NcE4g3M6m6vpzFLUOsP6shsOTwTROtKGprAPJ5+1Y/znpJXUtWE9r5ESxn9N4nSiEwdCR5D49rqSlOruE9q3w15974Z42uTvzxUNexY1rDer/T6hxOLb5LPwv+q21rhOWM/VTF9+fwNvqBVfp3/w76Ki/D2hwkS5XI5DY21hn1OJhreZDyiWlWpCdWFDs1HNSqVSEEURkiRBlmXe0Auld7WH2WwWyWQSmUwG6XTakdKEecL/1IeLtZL9wFwndJwypQ5+zn67aWw39X8NzeuL91b1mloKzLXW9aVpJSxnCY+lFzjV0YvzPTfQ3j1QwaXruHBlkI3Zu2cQXX1D6Oi9yTn/xX742bylZTjHcKbrGi4P3IHQefUWVqzfinVb9mH1Jg/WbPZg1cZdaPA0w3v4OHYcOortTT407m/BNvY+6DuBvc3HsLZhD9Pv5npzvHLDTjR6WyC8//gJdwNRBCJPcD8cdyAUG0Uw9pSPA49EPIyKiMRlhEdGHboHkTjuBWOIis/xBxooB7yFLBzFAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    ></span>
    <img
        class="gatsby-resp-image-image"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
        alt="CPU Usage"
        title=""
        src="/static/25fc9396db647a3270c468e3a1ff26c8/37844/cpu.png"
        srcset="/static/25fc9396db647a3270c468e3a1ff26c8/95c64/cpu.png 148w,
/static/25fc9396db647a3270c468e3a1ff26c8/0d14f/cpu.png 295w,
/static/25fc9396db647a3270c468e3a1ff26c8/37844/cpu.png 347w"
        sizes="(max-width: 347px) 100vw, 347px"
      />
  </span>
  </a></p>
<h3>Worker</h3>
<p>Let us write a small script that mocks real events by calling mutation for 4 panels at regular intervals. We will use <a href="https://www.npmjs.com/package/node-schedule">node-schedule</a> package.</p>
<p>Install the dependencies</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">yarn add node-schedule request request-promise</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Define the mutations for each panels</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> queries <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">CPU</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
    mutation {
      cpu {
        percentage
      }
    }
    `</span></span><span class="token punctuation">,</span>
  <span class="token constant">TRAFFIC</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
    mutation {
      traffic {
        total
        dps {
          timestamp
          value
        }
      }
    }
    `</span></span><span class="token punctuation">,</span>
  <span class="token constant">DISTRIBUTION</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
    mutation {
      distribution {
        region
        percentage
      }
    }
    `</span></span><span class="token punctuation">,</span>
  <span class="token constant">MESSAGES</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
    mutation {
      messages {
        title
        description
        color
      }
    }
    `</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>For example, add a scheduler for CPU using <code class="language-text">schedule.scheduleJob</code> for every 3 seconds</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> schedule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"node-schedule"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

schedule<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span><span class="token string">"*/3 * * * * *"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">makeHttpRequest</span><span class="token punctuation">(</span><span class="token string">"CPU"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Call mutation for CPU panel</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Fetched new results for CPU"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Refer <a href="https://github.com/nowke/realtime-dashboard-demo/blob/master/worker/worker.js">worker/worker.js</a> for complete script</p>
<p>Run the worker</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">$ yarn start
yarn run v1.13.0
$ node worker.js
Starting worker
Scheduled Jobs for CPU, Traffic, distribution, messages
Fetched new results for TRAFFIC
Fetched new results for MESSAGES
Fetched new results for CPU
Fetched new results for DISTRIBUTION
Fetched new results for CPU
Fetched new results for MESSAGES
Fetched new results for TRAFFIC
...
...</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<img src="/demo-c4fc92aed4a93e02edf4e7e71dd700e5.gif" alt="Real-time dashboard preview" style="border: 1px solid #000;">
<h2>Scaling</h2>
<p>For high-availability, server will be deployed in multiple instances connected using Load-balancer. </p>
<p>Consider 4 servers <code class="language-text">server1</code>, <code class="language-text">server2</code>, <code class="language-text">server3</code> and <code class="language-text">server4</code>. When a user opens the browser (client), it can connect to any of the servers via load-balancer. All of these servers are connected to a redis cluster <code class="language-text">redis-cluster</code></p>
<p>If nginx is used, routing websocket requests is possible by changing the configuration. Refer <a href="https://www.nginx.com/blog/websocket-nginx/">www.nginx.com/blog/websocket-nginx/</a> for details.</p>
<h3>Architecture diagram</h3>
<p>The following diagram represents where 4 clients are connected to 4 servers via load-balancer</p>
<p><img src="/arch-diagram-1ee36dfd846a36d6f1e0381a76234eb0.svg" alt="Architecture diagram"></p>
<p>Analyzing a request flow from <strong>Worker</strong>,</p>
<p><img src="/request-analysis-2c1a3c8c89e33548d823eb6e8388f567.svg" alt="Request analysis"></p>
<ol>
<li>Worker makes a <strong><code class="language-text">POST</code></strong> request (a <strong>mutation</strong>) to one of the servers (via <strong>load balancer</strong>), say <code class="language-text">server1</code></li>
<li><strong><code class="language-text">server1</code></strong> sends <strong><code class="language-text">PUBLISH</code></strong> command to redis cluster with data for <code class="language-text">cpu</code></li>
<li>Since all servers are subscribed to same channel in redis, all of them receive data for <code class="language-text">cpu</code></li>
<li>Servers publish the data via websocket to all the clients.</li>
</ol></div></div><br/><br/><br/></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-notebook-js","jsonName":"realtime-dashboard-2f3","path":"/realtime-dashboard/"};window.dataPath="180/path---realtime-dashboard-2-f-3-142-mhFMNm4kU20BzzzHRz0QfPIkM";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-993239f85bfee703f187.js"],"component---src-templates-notebook-js":["/component---src-templates-notebook-js-c805186f3ab5e970b418.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2ad87f0ab56fce9702d2.js"],"pages-manifest":["/pages-manifest-e35e57d67e437ff66c44.js"]};/*]]>*/</script><script src="/component---src-templates-notebook-js-c805186f3ab5e970b418.js" async=""></script><script src="/1-4ee94accbe56df593520.js" async=""></script><script src="/styles-b03ebb414d027cb36da8.js" async=""></script><script src="/app-993239f85bfee703f187.js" async=""></script><script src="/webpack-runtime-545d7a8d911f5a40b60c.js" async=""></script></body></html>